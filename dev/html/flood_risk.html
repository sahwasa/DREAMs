@@include('../inc/top.html')
<div id="wrap" class="wrap">
  @@include('../inc/header.html')    
  <main id="content" class="main_container">
    <section class="pannel">
      <div class="pannel_wrap">
        <header class="tit">
          <h1>실시간 모니터링</h1>
          <div class="tool">
            <button type="button" class="btn_ex">도움말</button>
          </div>
        </header>
        <div class="summary">
          <p>2023.10.10 침수예측 미확인 현황  <em>4건</em></p>
        </div>
        <div class="pannel_body">
          <ul class="place_lst">
            <li class="grade4 on" tabindex="0">
              <strong>침수위험</strong>
              <ul class="dot_lst">
                <li><em>담당자</em>홍길동</li>
                <li><em>침수예측일자</em>2023-10-10 12:34:56</li>
                <li><em>대상지역</em>경기도 용인시</li>
              </ul>
            </li>
            <li class="grade3" tabindex="0">
              <strong>침수경계</strong>
              <ul class="dot_lst">
                <li><em>담당자</em>홍길동</li>
                <li><em>침수예측일자</em>2023-10-10 12:34:56</li>
                <li><em>대상지역</em>경기도 용인시</li>
              </ul>
            </li>
            <li class="grade2" tabindex="0">
              <strong>침수주의</strong>
              <ul class="dot_lst">
                <li><em>담당자</em>홍길동</li>
                <li><em>침수예측일자</em>2023-10-10 12:34:56</li>
                <li><em>대상지역</em>경기도 용인시</li>
              </ul>
            </li>
            <li class="grade1" tabindex="0">
              <strong>침수안전</strong>
              <ul class="dot_lst">
                <li><em>담당자</em>홍길동</li>
                <li><em>침수예측일자</em>2023-10-10 12:34:56</li>
                <li><em>대상지역</em>경기도 용인시</li>
              </ul>
            </li>
            <li class="grade1" tabindex="0">
              <strong>침수안전</strong>
              <ul class="dot_lst">
                <li><em>담당자</em>홍길동</li>
                <li><em>침수예측일자</em>2023-10-10 12:34:56</li>
                <li><em>대상지역</em>경기도 용인시</li>
              </ul>
            </li>
            <li class="grade1" tabindex="0">
              <strong>침수안전</strong>
              <ul class="dot_lst">
                <li><em>담당자</em>홍길동</li>
                <li><em>침수예측일자</em>2023-10-10 12:34:56</li>
                <li><em>대상지역</em>경기도 용인시</li>
              </ul>
            </li>
            <li class="grade1" tabindex="0">
              <strong>침수안전</strong>
              <ul class="dot_lst">
                <li><em>담당자</em>홍길동</li>
                <li><em>침수예측일자</em>2023-10-10 12:34:56</li>
                <li><em>대상지역</em>경기도 용인시</li>
              </ul>
            </li>
          </ul>
        </div>        
      </div>
    </section>
    <div class="flood_risk">
      <section class="map_wrap">
        <div class="temp_map">
          <img src="../images/temp/map-flood.png" id="temp_map" width="100%" height="auto" alt="임시 지도배경">
        </div>
        <div class="map_ctrl">        
          <ul class="map_tool">
            <li><button type="button" class="btn_refresh_square">새로고침</button></li>
            <li>
              <div class="vertical_group">
                <button type="button" class="btn_zoomin_square">확대</button>
                <button type="button" class="btn_zoomout_square">축소</button>
              </div>
            </li>
          </ul>
          <ul class="map_type btn_switch">
            <li><input type="checkbox" id="map_type1" name="map_type"><label for="map_type1">IOT센서</label></li>
            <li><input type="checkbox" id="map_type2" name="map_type"><label for="map_type2">맨홀</label></li>
            <li><input type="checkbox" id="map_type3" name="map_type"><label for="map_type3">관로</label></li>
            <li><input type="checkbox" id="map_type4" name="map_type"><label for="map_type4">CCTV</label></li>
          </ul>
          <div class="map_layer">
            <button type="button" onclick="toggle('.p_forecast');" class="btn_forecast weather1">23℃ 맑음</button>
            @@include('../inc/pop/p_forecast.html')
            <button type="button" class="btn_radar" onclick="document.querySelector('.p_forecast').close();">레이더</button>
          </div>
          <ul class="map_style btn_switch">
            <li><input type="radio" id="default_view" name="map_style" checked><label for="default_view">일반지도</label></input></li>
            <li><input type="radio" id="sky_view" name="map_style"><label for="sky_view">위성지도</label></input></li>
            <li><input type="radio" id="2d_view" name="map_style"><label for="2d_view">2D지도</label></input></li>
          </ul>
          <div class="lst_cctv">
            <button type="button" style="--x:400;--y:300;">cctv</button>
            <button type="button" style="--x:200;--y:400;">cctv</button>
            <button type="button" style="--x:350;--y:350;">cctv</button>
          </div>
          <div class="lst_sensor">
            <button type="button" style="--x:300;--y:300;">sensor</button>
            <button type="button" style="--x:500;--y:400;">sensor</button>
            <button type="button" style="--x:250;--y:450;">sensor</button>
            <button type="button" style="--x:300;--y:200;">sensor</button>
            <div class="layer">
              <button type="button" class="btn_del">close</button>
              <strong>IOT센서</strong>
              <ul class="dot_lst">
                <li><em>분류코드</em>S15</li>
                <li><em>유형</em>하천 수위계</li>
                <li><em>설치장소</em>경안천 상류</li>
                <li><em>수위</em>9.5m</li>
              </ul>
            </div>            
          </div>
          <div class="lst_maker">
            <button type="button" style="--x:820;--y:380;" class="maker_pump on">신원 제1 빗물 펌프장 빗물 펌프장</button>
            <button type="button" style="--x:700;--y:200;" class="maker_pump">신원 제2 빗물 펌프장</button>
            <button type="button" style="--x:820;--y:280;" class="maker_storage">신원 강우량계</button>
            <button type="button" style="--x:900;--y:400;" class="maker_floemeter">신원 유량계</button>
            <button type="button" style="--x:950;--y:500;" class="maker_watergauge">신원 수위계</button>
            <div class="tooltip maker_pump">
              <strong>신원 제1빗물 펌프장</strong>
              <i class="default">정상</i>
            </div>
          </div>
          <div class="map_legend">
            <details open>
              <summary>
                <h1>범례</h1>
              </summary>
              <div class="legend_body">
                <section class="symbols">
                  <ul>
                    <li>빗물 펌프장</li>
                    <li>강우량계</li>
                    <li>유량계</li>
                    <li>수위계</li>
                  </ul>
                </section>
                <section class="lenend_layer">
                  <ul>
                    <li><label for="map_layer1"><input type="checkbox" id="map_layer1" name="" checked />수신상태</label></li>
                    <li><label for="map_layer2"><input type="checkbox" id="map_layer2" name="" checked />하천수위</label></li>
                    <li><label for="map_layer3"><input type="checkbox" id="map_layer3" name="" checked />용도지역</label></li>
                    <li><label for="map_layer4"><input type="checkbox" id="map_layer4" name="" checked />도시침수</label></li>
                  </ul>
                </section>
                <details open class="signal">
                  <summary>수신상태</summary>
                  <ul>
                    <li>정상</li>
                    <li>미수신</li>
                    <li>지연</li>
                  </ul>
                </details>
                <details open class="zoning">
                  <summary>용도지역</summary>
                  <ul>
                    <li>상업지역</li>
                    <li>주거지역</li>
                    <li>녹지지역</li>
                    <li>공업지역</li>
                  </ul>
                </details>
                <details open class="water_level">
                  <summary>하천수위</summary>
                  <ul>
                    <li>1등급</li>
                    <li>2등급</li>
                    <li>3등급</li>
                    <li>4등급</li>
                    <li>5등급</li>
                    <li>6등급</li>
                    <li>7등급</li>
                    <li>8등급</li>
                    <li>9등급</li>
                    <li>10등급</li>
                  </ul>
                </details>
                <details open class="flooding">
                  <summary>도시침수</summary>
                  <ul>
                    <li>1등급 (0.5m 미만)</li>
                    <li>2등급 (0.5m ~ 1.0m 미만)</li>
                    <li>3등급 (1.0m ~ 2.0m 미만)</li>
                    <li>4등급 (2.0m ~ 5.0m 미만)</li>
                    <li>5등급 (5.0m미만)</li>
                  </ul>
                </details>
              </div>
            </details>
          </div>
          @@include('../inc/playbar.html')
        </div>
      </section>
      <section class="dtl_info">
        <header><h1>신원 제1 빗물 펌프장</h1></header>
        <div class="dtl_content">
          <section class="oper_status">
            <ul>
              <li><em>운영상태</em><i class="operating">가동중</i></li>
              <!-- <li><em>운영상태</em><i class="stop">정지</i></li> -->
              <li><em>펌프장 수위</em>8.2㎧</li>
              <li><em>유수지 유입량</em>5.2t/min</li>
              <li><em>방류량</em>2t/min</li>
            </ul>
            <div class="water_gage" style="--gage:22.1">
              <div class="gage_wrap">
                <div class="gage"></div>
              </div>
              <em>현재수위 2.21</em>
            </div>
          </section>
          <section class="flood_chart">
            <h2>도시침수 위험 예상시각<span class="date">2023-10-21 18:35:00</span><em>(120분 후)</em></h2>
            <div class="chart_wrap">
              <canvas id="chart_flood" style="width:100%;height:120px;"></canvas>
              <div id="flood_legend"></div>
            </div>
          </section>
          <section class="flood_status">
            <header class="tit">
              <h2>침수 위험상태</h2>
              <div class="tool">
                <button type="button" class="btn_esop">e-SOP 상세</button>
              </div>
            </header>
            <div class="dtl step2">
              <p>침수위험 <em>주의</em> 상태입니다.</p>
            </div>            
          </section>
        </div>
      </section>
    </div>
  </main>
</div>
@@include('../inc/script.html')
<script src="../plugins/chart.js/dist/chart.umd.js"></script>
<script src="../js/chart_temp.js"></script>
<script src="../js/chart_flood.js"></script>
<script src="../js/monitoring.js"></script>
<script>
//maker 툴팁

  // const makers = document.querySelectorAll('.lst_maker button');
  // const layer = document.querySelector('.lst_maker .tooltip');
//   makers.forEach(button => {
//     button.addEventListener('mouseenter',function(event){
//       const target = event.target;
//       const x = target.style.getPropertyValue('--x');
//       const y = target.style.getPropertyValue('--y');
//       const initTxt = target.textContent;
//       layer.style.left = parseInt(x,10) - 10 + 'px';
//       layer.style.top = parseInt(y,10) - 60 + 'px';
//       layer.style.display='flex';
//       layer.classList.add(target.classList[0]);
//       layer.children[0].innerText=initTxt;
//     })
//     button.addEventListener('mouseleave',function(event){
//       const initClass = layer.classList[1];
//       layer.style.display='none';
//       layer.classList.remove(initClass);
//     })    
// })
const lst_maker = document.querySelector('.lst_maker');
lst_maker.addEventListener('click', function(event) {
  const layer = event.currentTarget.querySelector('.tooltip');
  const target = event.target;
  if (target.tagName === 'BUTTON') {
    const buttons = document.querySelectorAll('.lst_maker button')
    buttons.forEach(button => {
      button.classList.remove('on');
    });
    const initTxt = target.textContent;
    const type = target.classList[0];
    const x = target.style.getPropertyValue('--x');
    const y = target.style.getPropertyValue('--y');
    target.classList.add('on');
    layer.style.left = parseInt(x,10) - 10 + 'px';
    layer.style.top = parseInt(y,10) - 60 + 'px';
    layer.style.display='flex';
    if(layer.classList[1]) layer.classList.remove(layer.classList[1]);
    layer.classList.add(type);
    layer.children[0].innerText=initTxt;
  }
});

//플레이바
playbarEvt();

window.onresize = function(){
  posPlaybar = playbarInit();
  var pctW = pct.offsetWidth,
      calcPctW = Math.round(pctW / posPlaybar.width * 100);

  if (calcPctW > 100) calcPctW = 100;
  pct.style.width = calcPctW + "%";
  playbarEvt();
}
function playbarEvt(){
  var playbar = document.getElementById('playbar'),
      pct = document.getElementById('pct');
      // ctrl = document.getElementById('ctrl');
  dragEvt(pct);
  clickEvt(playbar);
}
function playbarInit(){
  posPlaybar = {
    // loc : playbar.offsetParent.offsetLeft + playbar.offsetLeft,//부모 왼쪽 좌표
    width : playbar.offsetWidth, //바 길이
    loc : playbar.getBoundingClientRect()
  };
  return posPlaybar;
}

function clickEvt(el){
  var pos1 = 0, pos2 = 0;
  posPlaybar = playbarInit();
  el.onmousedown = onMouseDown;
  function onMouseDown(e){
    pos2 = e.clientX;
    pos1 = pos2 - posPlaybar.loc.left;
    pct.style.width = pos1 + "px";
  }
}

function dragEvt(el){
  var pos1 = 0, pos2 = 0;

  posPlaybar = playbarInit();
  el.onmousedown = dragStrat;
  el.ontouchstart = dragStrat;

  function dragStrat(e){
    pos2 = e.clientX;       
    document.onmouseup = closeDragElement;
    document.ontouchend = closeDragElement;
    // document.ontouchcancel = closeDragElement;
    document.onmousemove = elementDrag;
    document.ontouchmove = elementDrag;
  }
  function elementDrag(e){
    e = e || window.event;
    console.log(pos1, pos2)
    
    if(e.type === 'mousemove'){
      pos1 = pos2 - e.clientX;
      pos2 = e.clientX;
    }else{
      pos1 = pos2 - e.touches[0].clientX;
      pos2 = e.touches[0].clientX;
    }
    posCalc =  pct.offsetWidth - pos1;

    if (posCalc >= posPlaybar.width) return;
    pct.style.width = posCalc + "px";
  }

  function closeDragElement(){
    document.onmouseup = null;
    document.onmousemove = null;
    document.ontouchend = null;
    document.ontouchmove = null;
  }
}
</script>
</body>
</html>